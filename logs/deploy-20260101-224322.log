[0;36mâ„¹  Target: root@mittonvillage.com:/var/www/galaxy-miner[0m
[0;36mâ„¹  Domain: galaxyminer.mittonvillage.com[0m
[0;32mâœ“ Deployment lock acquired[0m

[0;34m==>[1m Checking local prerequisites[0m
[0;32mâœ“ tar is installed[0m
[0;32mâœ“ node is installed (v22.21.0)[0m
[0;32mâœ“ SSH key found: /home/eric/.ssh/id_ed25519[0m
[0;32mâœ“ .env.production found[0m
[0;32mâœ“ ecosystem.config.js found[0m
[0;32mâœ“ package.json found[0m

[0;34m==>[1m Running pre-deployment validation[0m
[0;36mâ„¹  Running test suite...[0m

> galaxy-miner@1.0.0 test
> vitest run

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v2.1.9 /home/eric/Projects/galaxy-miner

 âœ“ tests/unit/server/void-loot.test.js (18 tests) 7ms
 âœ“ tests/unit/shared/utils.test.js (41 tests) 6ms
 âœ“ tests/unit/server/void-leviathan.test.js (36 tests) 8ms
 âœ“ tests/unit/network/event-contracts.test.js (32 tests) 15ms
 âœ“ tests/unit/shared/physics.test.js (34 tests) 18ms
 âœ“ tests/unit/server/auth.test.js (21 tests) 296ms

 Test Files  6 passed (6)
      Tests  182 passed (182)
   Start at  22:43:22
   Duration  554ms (transform 97ms, setup 0ms, collect 196ms, tests 350ms, environment 1ms, prepare 442ms)

[0;32mâœ“ Tests passed[0m
[0;32mâœ“ Pre-deployment validation passed[0m

[0;34m==>[1m Checking SSH connectivity[0m
[0;32mâœ“ SSH connection to mittonvillage.com verified[0m

[0;34m==>[1m Checking remote prerequisites[0m
[0;32mâœ“ Remote node: v20.19.6[0m
[0;32mâœ“ Remote npm installed[0m
[0;32mâœ“ Remote pm2 installed[0m
[0;32mâœ“ Remote nginx installed[0m
[0;32mâœ“ Remote certbot installed[0m

[0;34m==>[1m Creating remote backup[0m
[0;32mâœ“ Backup created: /var/backups/galaxy-miner/backup-20260101-224337.tar.gz[0m
[0;36mâ„¹  Old backups cleaned up (keeping last 5)[0m

[0;34m==>[1m Creating deployment package[0m
[0;36mâ„¹  Packaging application files...[0m
[0;32mâœ“ Deployment package created: 4.7M[0m

[0;34m==>[1m Transferring to remote server[0m
[0;36mâ„¹  Uploading deployment package...[0m
[0;32mâœ“ Package uploaded[0m
[0;36mâ„¹  Stopping PM2 process for deployment...[0m
[0;36mâ„¹  Extracting on remote server...[0m
[0;32mâœ“ Package extracted[0m
[0;32mâœ“ Code deployed[0m

[0;34m==>[1m Installing dependencies[0m
[0;36mâ„¹  Installing production dependencies (this may take a moment)...[0m
[0;32mâœ“ Dependencies installed[0m

[0;34m==>[1m Deploying environment configuration[0m
[0;36mâ„¹  Environment file unchanged, skipping[0m

[0;34m==>[1m Checking database[0m
[0;36mâ„¹  Database already exists, preserving data[0m

[0;34m==>[1m Deploying with PM2[0m
[0;36mâ„¹  Restarting PM2 process...[0m
[0;32mâœ“ PM2 deployment complete[0m

[0;34m==>[1m Deploying Nginx configuration[0m
[0;36mâ„¹  Nginx config unchanged, skipping[0m

[0;34m==>[1m Setting up SSL certificate[0m
[0;32mâœ“ SSL certificate already exists[0m
[0;36mâ„¹  Certificate expiry:     Expiry Date: 2026-03-19 02:47:39+00:00 (VALID: 75 days)[0m

[0;34m==>[1m Verifying deployment[0m
[0;36mâ„¹  Waiting for PM2 process to start...[0m
[0;32mâœ“ PM2 process is online[0m
[0;36mâ„¹  Waiting for health endpoint...[0m
[0;32mâœ“ Health check passed (local)[0m
[0;32mâœ“ Health check passed (https://galaxyminer.mittonvillage.com)[0m

[0;34m==>[1m Deployment Summary[0m
[0;32mâœ“ Galaxy Miner deployed successfully![0m
[0;36mâ„¹  [0m
[0;36mâ„¹  Application URL: https://galaxyminer.mittonvillage.com[0m
[0;36mâ„¹  Health endpoint: https://galaxyminer.mittonvillage.com/health[0m
[0;36mâ„¹  [0m
[0;36mâ„¹  Useful commands:[0m
[0;36mâ„¹    View logs:     ssh root@mittonvillage.com 'pm2 logs galaxy-miner'[0m
[0;36mâ„¹    Restart app:   ssh root@mittonvillage.com 'pm2 restart galaxy-miner'[0m
[0;36mâ„¹    Stop app:      ssh root@mittonvillage.com 'pm2 stop galaxy-miner'[0m
[0;36mâ„¹    App status:    ssh root@mittonvillage.com 'pm2 status'[0m
[0;36mâ„¹  Cleaned up local deployment package[0m
